---
description: Link-Local Multicast Name Resolution
---

# LLMNR Attack

> ### _What is LLMNR?_
>
> **LLMNR** is a protocol that allows both IPv4 and IPv6 hosts to perform name resolution for hosts on the same local network without requiring a DNS server or DNS configuration.
>
> When a host’s DNS query fails (i.e., the DNS server doesn’t know the name), the host broadcasts an LLMNR request on the local network to see if any other host can answer.
>
> LLMNR is the successor to NetBIOS. **NetBIOS** (Network Basic Input/Output System) is an older protocol that was heavily used in early versions of Windows networking. **NBT-NS** is a component of NetBIOS over TCP/IP (NBT) and is responsible for name registration and resolution. Like LLMNR, NBT-NS is a fallback protocol when DNS resolution fails. It allows local name resolution within a LAN.

<figure><img src="../../../../.gitbook/assets/image (34).png" alt=""><figcaption></figcaption></figure>

```basic
sudo responder -I eth0 -dwP
```

<figure><img src="../../../../.gitbook/assets/image (35).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (39).png" alt=""><figcaption></figcaption></figure>



<figure><img src="../../../../.gitbook/assets/image (40).png" alt=""><figcaption></figcaption></figure>

### Mitigated

#### Main Defense – Disable LLMNR and NBT-NS

**To disable **<mark style="color:red;">**LLMNR**</mark>**, select “Turn OFF Multicast Name Resolution”  under Computer Configuration -> Administrative Templates -> Network > DNS Client in the Group Policy Editor of Active Directory.**

<figure><img src="../../../../.gitbook/assets/image (36).png" alt=""><figcaption></figcaption></figure>

**To disable **<mark style="color:red;">**NBT-NS**</mark>**, navigate to Network Connections > Network Adapter Properties > TCP/IPv4 Properties > Advanced tab > WINS tab and select “Disable NetBIOS over TCP/IP” in Active Directory. This only works locally.**

{% embed url="https://tcm-sec.com/wp-content/uploads/2023/09/llmnr-5.png" %}

{% code overflow="wrap" %}
```powershell
set-ItemProperty -Path HKLM:\SYSTEM\CurrentControlSet\services\NetBT\Parameters\Interfaces\tcpip* -Name NetbiosOptions -Value 2
```
{% endcode %}

<figure><img src="../../../../.gitbook/assets/image (37).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (38).png" alt=""><figcaption></figcaption></figure>

#### Confirming Our Mitigation

**We can confirm that we have mitigated LLMNR by running the following command in PowerShell and receiving a ‘0’ in return:**

{% code overflow="wrap" %}
```powershell
$(Get-ItemProperty -Path "HKLM:\Software\Policies\Microsoft\Windows NT\DNSClient" -name EnableMulticast).EnableMulticast
```
{% endcode %}

<figure><img src="https://tcm-sec.com/wp-content/uploads/2023/09/llmnr-8.png" alt=""><figcaption></figcaption></figure>

Click the image to view in full resolution.

**We can confirm that we have mitigated NBT-NS by running the following command in cmd.exe and receiving a ‘2’ in return:**

```powershell
wmic nicconfig get caption,index,TcpipNetbiosOptions
```

<figure><img src="https://tcm-sec.com/wp-content/uploads/2023/09/llmnr-9.png" alt=""><figcaption></figcaption></figure>

